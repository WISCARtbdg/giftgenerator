<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8">
<title>Gift Profile Mini‑App</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<script src="https://telegram.org/js/telegram-web-app.js"></script>

<style>
  :root{
    --tg-blue:#30A4F2; --tg-yellow:#FFCC00; --tg-violet:#6C5CFF; --tg-teal:#00C896;
    --bg-modal:rgba(0,0,0,.75); --bg-btn:#1D9BF0;
  }
  *{box-sizing:border-box;margin:0;padding:0;font-family:sans-serif;}
  /* ▸ Градиент: центр тёмный, к краям светлее */
  body{
    min-height:100vh;display:flex;flex-direction:column;align-items:center;text-align:center;
    background:radial-gradient(circle,#2b2b2b 0%,#3d3d3d 40%,#5a5a5a 100%);color:#fff;
  }
  #avatar-box{position:relative;margin-top:40px}
  #avatar{width:160px;height:160px;border-radius:50%;object-fit:cover;border:4px solid var(--tg-blue);}
  #gift-layer{position:absolute;inset:0;width:160px;height:160px;pointer-events:none;}

  #name{margin-top:12px;font-size:20px;font-weight:600;}
  #gift-btn{
    position:fixed;left:50%;bottom:16px;transform:translateX(-50%);
    background:var(--bg-btn);color:#fff;border:none;border-radius:24px;
    padding:14px 32px;font-size:18px;cursor:pointer;box-shadow:0 4px 10px rgba(0,0,0,.15);
  }

  /* ── Модалка ─────────────────────────────────────────────────── */
  #modal{display:none;position:fixed;inset:0;background:var(--bg-modal);padding:24px;overflow:auto;}
  #modal.show{display:block;}
  #modal-inner{background:#fff;color:#222;border-radius:12px;padding:20px;max-width:420px;margin:40px auto;}
  h3{margin:12px 0 8px;font-size:18px;}
  .gift-option{width:40px;height:40px;border-radius:8px;object-fit:cover;cursor:pointer;margin:6px;filter:grayscale(20%);}
  .gift-option.selected{outline:3px solid var(--tg-blue);}
  .bg-option{width:36px;height:36px;border-radius:50%;display:inline-block;cursor:pointer;margin:4px;border:2px solid transparent;}
  .bg-option.selected{border-color:#000;}
  #next,#save{margin-top:18px;padding:10px 24px;font-size:16px;border:none;border-radius:20px;color:#fff;cursor:pointer;}
  #next{background:var(--tg-blue);}
  #save{background:var(--tg-teal);}
  /* скрываем второй шаг до тех пор, пока не выберут подарок */
  .step{display:none;}
  .step.active{display:block;}
</style>
</head>

<body>
  <div id="avatar-box">
    <img id="avatar" src="https://placehold.co/160x160?text=%F0%9F%92%BB" alt="avatar">
    <img id="gift-layer" src="" alt="" style="display:none;">
  </div>
  <div id="name">Гость</div>

  <button id="gift-btn">Подарки 🎁</button>

  <!-- МОДАЛКА -->
  <div id="modal">
    <div id="modal-inner">
      <!-- Шаг 1 -->
      <div class="step" id="step‑gift">
        <h3>Выбери подарок</h3>
        <div id="gift-list"></div>
        <button id="next" disabled>Дальше</button>
      </div>
      <!-- Шаг 2 -->
      <div class="step" id="step‑bg">
        <h3>Цвет фона</h3>
        <div id="bg-list"></div>
        <button id="save">Закрепить</button>
      </div>
    </div>
  </div>

<script>
const tg = window.Telegram.WebApp; tg.ready();
const user = tg.initDataUnsafe?.user || {};
document.getElementById('name').textContent = user.first_name || 'Гость';
if (user.photo_url) document.getElementById('avatar').src = user.photo_url;

/* ---------- ДАННЫЕ ---------- */
const gifts = [
  {id:1,gif:'snup1.gif',color:'#30A4F2'},
  {id:2,gif:'snup2.gif',color:'#FFCC00'}
];
const backgrounds = ['#30A4F2','#FFCC00','#6C5CFF','#00C896'];

/* ---------- РЕНДЕР ---------- */
const giftList = document.getElementById('gift-list');
gifts.forEach(g=>{
  const img=document.createElement('img');
  img.className='gift-option'; img.src=g.gif;
  img.onclick=()=>selectGift(g,img);
  giftList.appendChild(img);
});
const bgList=document.getElementById('bg-list');
backgrounds.forEach(c=>{
  const d=document.createElement('span');
  d.className='bg-option'; d.style.background=c;
  d.onclick=()=>selectBg(c,d);
  bgList.appendChild(d);
});

/* ---------- ЛОГИКА ---------- */
let selectedGift=null, selectedBg=null;
function selectGift(g,el){
  selectedGift=g;
  document.querySelectorAll('.gift-option').forEach(x=>x.classList.remove('selected'));
  el.classList.add('selected');
  document.getElementById('next').disabled=false;
}
function selectBg(c,el){
  selectedBg=c;
  document.querySelectorAll('.bg-option').forEach(x=>x.classList.remove('selected'));
  el.classList.add('selected');
  preview();
}
function preview(){
  const img=document.getElementById('gift-layer');
  if(selectedGift){ img.src=selectedGift.gif; img.style.display='block'; }
  if(selectedBg){ document.body.style.background=`radial-gradient(circle,${selectedBg} 0%,${selectedBg}40%,#5a5a5a 100%)`; }
}

/* шаги модалки */
const stepGift=document.getElementById('step‑gift');
const stepBg=document.getElementById('step‑bg');
function openStep(step){ [stepGift,stepBg].forEach(s=>s.classList.remove('active')); step.classList.add('active'); }
openStep(stepGift);

document.getElementById('gift-btn').onclick=()=>{ openStep(stepGift); document.getElementById('modal').classList.add('show'); };
document.getElementById('next').onclick=()=>openStep(stepBg);

document.getElementById('modal').onclick=e=>{ if(e.target.id==='modal') e.target.classList.remove('show'); };

document.getElementById('save').onclick=async()=>{
  document.getElementById('modal').classList.remove('show');
  preview(); // применяем выбор
  // здесь можно вызвать API /save
};
</script>
</body>
</html>

<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8">
<title>Gift Profile Mini‑App</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<!-- defer = браузер загрузит SDK, когда HTML уже разобран -->
<script defer src="https://telegram.org/js/telegram-web-app.js"></script>

<style>
  /* ── ваши стили без изменений (чуть сжато) ───────────────── */
  :root{--tg-blue:#30A4F2;--tg-teal:#00C896;--bg-btn:#1D9BF0;--bg-modal:rgba(0,0,0,.75)}
  *{box-sizing:border-box;margin:0;padding:0;font-family:sans-serif}
  body{min-height:100vh;display:flex;flex-direction:column;align-items:center;text-align:center;
       background:radial-gradient(circle,#2b2b2b 0%,#3d3d3d 40%,#5a5a5a 100%);color:#fff;
       overflow:hidden;position:fixed;touch-action:none;overscroll-behavior:none}
  #avatar-box{position:relative;margin-top:40px}
  #avatar{width:160px;height:160px;border-radius:50%;object-fit:cover;border:4px solid var(--tg-blue)}
  #gift-layer{position:absolute;inset:0;width:160px;height:160px;pointer-events:none}
  #name{margin-top:12px;font-size:20px;font-weight:600}
  #name-edit,#avatar-file{margin-top:8px;padding:4px 8px;border:none;border-radius:6px;font-size:16px;text-align:center}
  #gift-btn{position:fixed;left:50%;bottom:16px;transform:translateX(-50%);
            background:var(--bg-btn);color:#fff;border:none;border-radius:24px;
            padding:14px 32px;font-size:18px;cursor:pointer;box-shadow:0 4px 10px rgba(0,0,0,.15)}
  #modal{display:none;position:fixed;inset:0;background:var(--bg-modal)}
  #modal.show{display:block}
  #modal-inner{width:100%;height:100%;display:flex;flex-direction:column;padding:16px}
  #close{align-self:flex-end;background:none;border:none;color:#fff;font-size:24px;cursor:pointer}
  #gift-scroll{flex:1;overflow-y:auto;overflow-x:hidden;touch-action:pan-y;overscroll-behavior:contain;padding-bottom:80px}
  .gift-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:12px}
  .gift-card{background:#1c1c1c;border-radius:12px;padding:12px;display:flex;justify-content:center;cursor:pointer;
             transition:transform .15s}
  .gift-card:hover{transform:translateY(-4px)}
  .gift-card img{width:72px;height:72px;object-fit:contain}
</style>
</head>

<body>
  <!-- профиль -->
  <div id="avatar-box">
    <img id="avatar" src="https://placehold.co/160x160?text=%F0%9F%92%BB" alt="avatar">
    <img id="gift-layer" src="" alt="" style="display:none;">
  </div>
  <div id="name">Гость</div>

  <input id="name-edit"  placeholder="Введите имя">
  <input id="avatar-file" type="file" accept="image/*">

  <button id="gift-btn">подарки</button>

  <!-- модалка -->
  <div id="modal">
    <div id="modal-inner">
      <button id="close">✕</button>
      <div id="gift-scroll"><div class="gift-grid" id="gift-grid"></div></div>
    </div>
  </div>

<script>
/* 1. Telegram init (опечатка исправлена) */
const tg = window.Telegram.WebApp; tg.ready();

/* 2. DOM‑ссылки */
const nameEdit   = document.getElementById('name-edit');
const avatarImg  = document.getElementById('avatar');
const avatarFile = document.getElementById('avatar-file');
const modal      = document.getElementById('modal');
const giftGrid   = document.getElementById('gift-grid');

/* 3. ваш список GIF — полностью, включая пустые '/' */
const gifts = [
  {id:1 ,gif:'/снуп.gif'},{id:2 ,
    gif:'/яйцо.gif'},
{id:3 ,gif:'/сигара снупа.gif'},
{id:4 ,gif:'/кока.gif'},
{id:5 ,gif:'/машина.gif'},
{id:6 ,gif:'/рука.gif'},
{id:7 ,gif:'/банка.gif'},
{id:8 ,gif:'/б-дай.gif'},
{id:9 ,gif:'/8марта.gif'},
{id:10,gif:'/бел.gif'},
{id:11,gif:'/брюлик.gif'},
{id:12,gif:'/букет.gif'},
{id:13,gif:'/глаз.gif'},
{id:14,gif:'/год.gif'},
{id:15,gif:'/желе.gif'},
{id:16,gif:'/зелье.gif'},
{id:17,gif:'/змея.gif'},
{id:18,gif:'/календарь.gif'},
{id:19,gif:'/клубника.gif'},
{id:20,gif:'/кольцо с брюликом.gif'},
{id:21,gif:'/кольцо.gif'},
{id:22,gif:'/меч.gif'},
{id:23,gif:'/мишка.gif'},
{id:24,gif:'/носок.gif'},
{id:25,gif:'/парфюм.gif'},
{id:26,gif:'/пепа.gif'},
{id:27,gif:'/персик.gif'},
{id:28,gif:'/печенька.gif'},
{id:29,gif:'/роза.gif'},
{id:30,gif:'/самотык.gif'},
{id:31,gif:'/санта.gif'},
{id:32,gif:'/сердце.gif'},
{id:33,gif:'/слкшать .gif'},
{id:34,gif:'/сумка.gif'},
{id:35,gif:'/торт.gif'},
{id:36,gif:'/тыква.gif'},
{id:37,gif:'/цветок.gif'},
{id:38,gif:'/череп.gif'},
{id:39,gif:'/чупик.gif'},
{id:40,gif:'/'},
{id:41,gif:'/'},
{id:42,gif:'/'},
{id:43,gif:'/'},
{id:44,gif:'/'},
{id:45,gif:'/'},
{id:46,gif:'/'},
{id:47,gif:'/'},
{id:48,gif:'/'},
{id:49,gif:'/'},
{id:50,gif:'/'},
{id:51,gif:'/'},
{id:52,gif:'/'},
{id:53,gif:'/'},
{id:54,gif:'/'},
{id:55,gif:'/'}
];

/* 4. загрузка сохранённого профиля */
let selectedGift = null;
const saved = JSON.parse(localStorage.getItem('profile')||'{}');
if(saved.name){ nameEdit.value=saved.name; document.getElementById('name').textContent=saved.name; }
if(saved.avatarData){ avatarImg.src=saved.avatarData; }

/* 5. рендер сетки (исправлена строка innerHTML) */
gifts.forEach(g=>{
  const card=document.createElement('div');
  card.className='gift-card';
  card.innerHTML=`<img loading="lazy" src="${g.gif}" alt="">`;
  card.onclick=()=>{ selectedGift=g; applyGift(); modal.classList.remove('show'); };
  giftGrid.appendChild(card);
});
/* восстановим подарок, если он был */
if(saved.giftId){
  const g=gifts.find(x=>x.id===saved.giftId);
  if(g){ selectedGift=g; applyGift(); }
}

/* 6. события UI */
document.getElementById('gift-btn').onclick=()=>modal.classList.add('show');
document.getElementById('close').onclick  =()=>modal.classList.remove('show');
modal.onclick=e=>{ if(e.target.id==='modal') modal.classList.remove('show'); };

nameEdit.oninput = ()=>{ document.getElementById('name').textContent=nameEdit.value||'Гость'; saveProfile(); };

avatarFile.onchange = e=>{
  const f=e.target.files[0]; if(!f) return;
  const r=new FileReader();
  r.onload=ev=>{ avatarImg.src=ev.target.result; saveProfile(); };
  r.readAsDataURL(f);
};

/* 7. функции */
function applyGift(){
  if(selectedGift && selectedGift.gif && selectedGift.gif!='/'){
    const layer=document.getElementById('gift-layer');
    layer.src=selectedGift.gif; layer.style.display='block';
  }
  saveProfile();
}
function saveProfile(){
  localStorage.setItem('profile',JSON.stringify({
    name:nameEdit.value,
    avatarData:avatarImg.src.startsWith('data:')?avatarImg.src:null,
    giftId:selectedGift?.id||null
  }));
}
</script>
</body>
</html>

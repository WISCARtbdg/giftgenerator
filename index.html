<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8">
<title>Gift Profile Mini‑App</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<!-- defer — скрипт загрузится после HTML -->
<script defer src="https://telegram.org/js/telegram-web-app.js"></script>

<style>
  :root{
    --tg-blue:#30A4F2; --tg-teal:#00C896;
    --bg-btn:#1D9BF0;  --bg-modal:rgba(0,0,0,.75);
  }
  *{box-sizing:border-box;margin:0;padding:0;font-family:sans-serif;}
  body{
    min-height:100vh;display:flex;flex-direction:column;align-items:center;text-align:center;
    background:radial-gradient(circle,#2b2b2b 0%,#3d3d3d 40%,#5a5a5a 100%);color:#fff;
    overflow:hidden;position:fixed;touch-action:none;overscroll-behavior:none;
  }
  /* аватар */
  #avatar-box{position:relative;margin-top:40px}
  #avatar{width:160px;height:160px;border-radius:50%;object-fit:cover;border:4px solid var(--tg-blue);}
  #gift-layer{position:absolute;inset:0;width:160px;height:160px;pointer-events:none;}
  #name{margin-top:12px;font-size:20px;font-weight:600;}

  /* поля ввода */
  #name-edit,#avatar-file{margin-top:8px;padding:4px 8px;border-radius:6px;border:none;font-size:16px;text-align:center;}

  /* кнопка «Подарки» */
  #gift-btn{
    position:fixed;left:50%;bottom:16px;transform:translateX(-50%);
    background:var(--bg-btn);color:#fff;border:none;border-radius:24px;
    padding:14px 32px;font-size:18px;cursor:pointer;box-shadow:0 4px 10px rgba(0,0,0,.15);
  }

  /* модалка на весь экран */
  #modal{display:none;position:fixed;inset:0;background:var(--bg-modal);}
  #modal.show{display:block;}
  #modal-inner{width:100%;height:100%;display:flex;flex-direction:column;padding:16px;}
  #close{align-self:flex-end;background:none;border:none;color:#fff;font-size:24px;cursor:pointer;}

  /* сетка подарков */
  #gift-scroll{flex:1;overflow-y:auto;overflow-x:hidden;touch-action:pan-y;overscroll-behavior:contain;padding-bottom:80px;}
  .gift-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;}
  .gift-card{background:#1c1c1c;border-radius:12px;padding:12px;display:flex;justify-content:center;transition:transform .15s;cursor:pointer;}
  .gift-card:hover{transform:translateY(-4px);}
  .gift-card img{width:72px;height:72px;object-fit:contain}
</style>
</head>

<body>
  <!-- профиль -->
  <div id="avatar-box">
    <img id="avatar" src="https://placehold.co/160x160?text=%F0%9F%92%BB" alt="avatar">
    <img id="gift-layer" src="" alt="" style="display:none;">
  </div>
  <div id="name">Гость</div>

  <!-- редактирование -->
  <input id="name-edit" placeholder="Введите имя">
  <input id="avatar-file" type="file" accept="image/*">

  <!-- кнопка -->
  <button id="gift-btn">Подарки</button>

  <!-- модалка -->
  <div id="modal">
    <div id="modal-inner">
      <button id="close">✕</button>
      <div id="gift-scroll">
        <div class="gift-grid" id="gift-grid"></div>
      </div>
    </div>
  </div>

<script>
/* ─── Инициализация Telegram ──────────────────────────────── */
const tg = window.Telegram.WebApp; tg.ready();

/* ─── DOM‑ссылки ──────────────────────────────────────────── */
const nameEdit   = document.getElementById('name-edit');
const avatarImg  = document.getElementById('avatar');
const avatarFile = document.getElementById('avatar-file');
const modal      = document.getElementById('modal');
const giftGrid   = document.getElementById('gift-grid');

/* ─── Каталог подарков ────────────────────────────────────── */
const gifts = [
  {id:1,gif:'/снуп.gif'},  {id:2,gif:'/яйцо.gif'},
  {id:3,gif:'/рука.gif'},  {id:4,gif:'/машина.gif'},
  {id:5,gif:'/букет.gif'}, {id:6,gif:'/роза.gif'}
];

/* ─── Сохранения ──────────────────────────────────────────── */
let selectedGift = null;
loadProfile();

/* ─── Рендер сетки ────────────────────────────────────────── */
gifts.forEach(g=>{
  const card=document.createElement('div');
  card.className='gift-card';
  card.innerHTML=`<img loading="lazy" src="${g.gif}" alt="">`;
  card.onclick=()=>{
    selectedGift=g;
    preview();
    modal.classList.remove('show');
  };
  giftGrid.appendChild(card);
});

/* ─── События ─────────────────────────────────────────────── */
document.getElementById('gift-btn').onclick=()=>modal.classList.add('show');
document.getElementById('close').onclick  =()=>modal.classList.remove('show');
modal.onclick=e=>{if(e.target.id==='modal')modal.classList.remove('show');};

nameEdit.oninput = ()=>{ document.getElementById('name').textContent = nameEdit.value || 'Гость'; saveProfile(); };

avatarFile.onchange = e=>{
  const file=e.target.files[0]; if(!file) return;
  const r=new FileReader();
  r.onload=ev=>{ avatarImg.src=ev.target.result; saveProfile(); };
  r.readAsDataURL(file);
};

/* ─── Функции ─────────────────────────────────────────────── */
function preview(){
  const layer=document.getElementById('gift-layer');
  if(selectedGift){ layer.src=selectedGift.gif; layer.style.display='block'; }
  saveProfile();
}

function saveProfile(){
  const profile={
    name:nameEdit.value,
    avatarData:avatarImg.src.startsWith('data:')?avatarImg.src:null,
    giftId:selectedGift?.id||null
  };
  localStorage.setItem('profile',JSON.stringify(profile));
}

function loadProfile(){
  const saved=JSON.parse(localStorage.getItem('profile')||'{}');
  if(saved.name){ nameEdit.value=saved.name; document.getElementById('name').textContent=saved.name; }
  if(saved.avatarData){ avatarImg.src=saved.avatarData; }
  if(saved.giftId){
    const g=gifts.find(x=>x.id===saved.giftId);
    if(g){ selectedGift=g; preview(); }
  }
}
</script>
</body>
</html>
